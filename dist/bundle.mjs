!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.RouteRenderer=e():t.RouteRenderer=e()}(self,(()=>(()=>{"use strict";var t={d:(e,o)=>{for(var r in o)t.o(o,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:o[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{Renderer:()=>u,WebGLOverlayView:()=>c});var o=function(){function t(){}return t.getTileSize=function(t){return 256*t},t.getMercatorWorldCoordinateProjection=function(t,e,o){var r=this.getTileSize(t),n=e*Math.PI/180;return{left:(o+180)*(r/360),top:r/2-r*Math.log(Math.tan(Math.PI/4+n/2))/(2*Math.PI)}},t.getPixelCoordinates=function(t,e,o){return{left:e*Math.pow(2,t),top:o*Math.pow(2,t)}},t.projectToPixelCoordinate=function(t,e){var o,r,n,i=this.getMercatorWorldCoordinateProjection(null!==(o=e.projectionZoomLevel)&&void 0!==o?o:2,t.latitude,t.longitude),a=this.getPixelCoordinates(null!==(r=e.projectionZoomLevel)&&void 0!==r?r:2,i.left,i.top);return{x:a.left,y:a.top,z:t.altitude*((null!==(n=e.projectionZoomLevel)&&void 0!==n?n:2)/100)}},t}(),r=function(){function t(){}return t.initPositionBuffer=function(t,e){var o=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,new Float32Array(e),t.STATIC_DRAW),o},t.initColorBuffer=function(t,e){for(var o=[],r=0;r<e.length;++r){var n=e[r];o=o.concat(n,n,n,n)}var i=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,i),t.bufferData(t.ARRAY_BUFFER,new Float32Array(o),t.STATIC_DRAW),i},t.initIndexBuffer=function(t,e){var o=t.createBuffer();return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,o),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(e),t.STATIC_DRAW),o},t}(),n=function(){function t(){}return t.createBuffers=function(t,e,o,n){for(var i,a,l,s=NaN,u=NaN,c=NaN,v=NaN,f=0,d=n;f<d.length;f++)for(var p=0,h=d[f].points;p<h.length;p++){var m=h[p];(window.isNaN(s)||m.x<s)&&(s=m.x),(window.isNaN(u)||m.x>u)&&(u=m.x),(window.isNaN(c)||m.y<c)&&(c=m.y),(window.isNaN(v)||m.y>v)&&(v=m.y)}var g=null!==(i=e.gridPadding)&&void 0!==i?i:1,y=[c-g,-.002,u+g,v+g,-.002,u+g,v+g,-.002,s-g,c-g,-.002,s-g],x=[null!==(l=null===(a=e.gridColor)||void 0===a?void 0:a.map((function(t){return t/255})))&&void 0!==l?l:[.5,0,0,1]],w=r.initPositionBuffer(t,y),R=r.initColorBuffer(t,x),b=r.initIndexBuffer(t,[0,1,2,0,2,3]);return{verticles:y.length/2,position:w,color:R,indices:b}},t}(),i=function(){function t(){}return t.createBuffers=function(t,e,o,n){for(var i,a,l,s,u,c,v,f,d,p,h,m,g,y,x,w,R,b,C,A,P,N=[],L=[],j=[],M=0,E=0,B=e.fullDistance*n.distanceFraction,F=1;F<e.points.length;F++){var S=e.points[F-1],T=e.points[F],_=S.z*n.elevationFraction,Y=T.z*n.elevationFraction,I=1;E=T.distanceStart;var z=null!==(s=null!==(i=T.color)&&void 0!==i?i:null===(l=null!==(a=o.leftWallColor)&&void 0!==a?a:o.wallColor)||void 0===l?void 0:l.map((function(t){return t/255})))&&void 0!==s?s:[0,1,0,1],U=null!==(f=null!==(u=T.color)&&void 0!==u?u:null===(v=null!==(c=o.rightWallColor)&&void 0!==c?c:o.wallColor)||void 0===v?void 0:v.map((function(t){return t/255})))&&void 0!==f?f:[0,0,1,1],V=null!==(p=null===(d=o.topColor)||void 0===d?void 0:d.map((function(t){return t/255})))&&void 0!==p?p:[1,0,0,1],G=null!==(m=null===(h=o.bottomColor)||void 0===h?void 0:h.map((function(t){return t/255})))&&void 0!==m?m:[0,0,0,1],O=null!==(w=null!==(g=T.color)&&void 0!==g?g:null===(x=null!==(y=o.endBlockColor)&&void 0!==y?y:o.wallColor)||void 0===x?void 0:x.map((function(t){return t/255})))&&void 0!==w?w:[0,0,0,1],X=null!==(A=null!==(R=T.color)&&void 0!==R?R:null===(C=null!==(b=o.startBlockColor)&&void 0!==b?b:o.wallColor)||void 0===C?void 0:C.map((function(t){return t/255})))&&void 0!==A?A:[0,0,0,1];if(E>B)break;B<E+T.distance&&(I=Math.max(0,Math.min((B-T.distanceStart)/T.distance,1)));var D={x:T.x-S.x,y:T.y-S.y},W=vec3.fromValues(S.y,S.x,_),k=vec3.fromValues(S.y+D.y*I,S.x+D.x*I,Y),Z=vec3.sub(vec3.create(),k,W),H=vec3.normalize(vec3.create(),[-Z[1],Z[0],0]),q=(null!==(P=o.wallWidth)&&void 0!==P?P:.1)/2,K=[vec3.add(vec3.create(),W,vec3.scale(vec3.create(),H,q)),vec3.add(vec3.create(),k,vec3.scale(vec3.create(),H,q))],Q=[vec3.sub(vec3.create(),W,vec3.scale(vec3.create(),H,q)),vec3.sub(vec3.create(),k,vec3.scale(vec3.create(),H,q))];N.push(Q[0][0],0,Q[0][1],Q[0][0],_,Q[0][1],Q[1][0],Y,Q[1][1],Q[1][0],0,Q[1][1]),N.push(K[0][0],0,K[0][1],K[0][0],_,K[0][1],K[1][0],Y,K[1][1],K[1][0],0,K[1][1]),N.push(K[0][0],K[0][2],K[0][1],K[1][0],K[1][2],K[1][1],Q[1][0],Q[1][2],Q[1][1],Q[0][0],Q[0][2],Q[0][1]),N.push(K[0][0],-.001,K[0][1],K[1][0],-.001,K[1][1],Q[1][0],-.001,Q[1][1],Q[0][0],-.001,Q[0][1]),L.push.apply(L,[z,U,V,G]),j.push.apply(j,[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15].map((function(t){return M+t}))),M+=16,T.verticles={frontRightX:K[1][1],frontRightY:K[1][0],frontRightZ:K[1][2],frontLeftX:Q[1][1],frontLeftY:Q[1][0],frontLeftZ:Q[1][2]},S.verticles&&(N.push(S.verticles.frontLeftY,0,S.verticles.frontLeftX,S.verticles.frontLeftY,S.verticles.frontLeftZ,S.verticles.frontLeftX,Q[0][0],Q[0][2],Q[0][1],Q[0][0],0,Q[0][1]),N.push(S.verticles.frontRightY,0,S.verticles.frontRightX,S.verticles.frontRightY,S.verticles.frontRightZ,S.verticles.frontRightX,K[0][0],K[0][2],K[0][1],K[0][0],0,K[0][1]),N.push(S.verticles.frontRightY,S.verticles.frontRightZ,S.verticles.frontRightX,K[0][0],K[0][2],K[0][1],Q[0][0],Q[0][2],Q[0][1],S.verticles.frontLeftY,S.verticles.frontLeftZ,S.verticles.frontLeftX),N.push(S.verticles.frontRightY,-.001,S.verticles.frontRightX,K[0][0],-.001,K[0][1],Q[0][0],-.001,Q[0][1],S.verticles.frontLeftY,-.001,S.verticles.frontLeftX),L.push.apply(L,[z,U,V,G]),j.push.apply(j,[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15].map((function(t){return M+t}))),M+=16),F===e.points.length-1?(N.push(K[1][0],0,K[1][1],K[1][0],Y,K[1][1],Q[1][0],Y,Q[1][1],Q[1][0],0,Q[1][1]),L.push.apply(L,[O]),j.push.apply(j,[0,1,2,0,2,3].map((function(t){return M+t}))),M+=4):1===F&&(N.push(Q[0][0],0,Q[0][1],Q[0][0],S.z,Q[0][1],K[0][0],S.z,K[0][1],K[0][0],0,K[0][1]),L.push.apply(L,[X]),j.push.apply(j,[0,1,2,0,2,3].map((function(t){return M+t}))),M+=4)}var J=r.initPositionBuffer(t,N),$=r.initColorBuffer(t,L),tt=r.initIndexBuffer(t,j);return{verticles:N.length/2,position:J,color:$,indices:tt}},t}(),a=function(){function t(){}return t.drawScene=function(t,e,o,r,n,i){var a,l,s,u,c,v,f,d,p,h;(null===(a=r.autoClear)||void 0===a||a)&&(t.clearColor(0,0,0,0),t.clearDepth(1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)),t.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL);var m=(null!==(l=r.cameraFov)&&void 0!==l?l:45)*Math.PI/180,g=t.canvas.clientWidth/t.canvas.clientHeight,y=mat4.create();(null===(s=r.keepPerspectiveProjection)||void 0===s||s)&&mat4.perspective(y,m,g,.1,1e3);var x=mat4.create();if(i){var w=[i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7],i[8],i[9],i[10],i[11],i[12],i[13],i[14],i[15]],R=mat4.fromValues.apply(null,w);mat4.multiply(x,x,R)}mat4.rotate(x,x,180/Math.PI*0,[0,0,1]),mat4.translate(x,x,null!==(u=r.cameraTranslation)&&void 0!==u?u:[0,0,-25]),mat4.rotate(x,x,(null!==(v=null===(c=r.cameraRotation)||void 0===c?void 0:c[1])&&void 0!==v?v:0)+.01*n.y,[1,0,0]),mat4.rotate(x,x,(null!==(d=null===(f=r.cameraRotation)||void 0===f?void 0:f[0])&&void 0!==d?d:0)+.01*n.x,[0,1,0]),mat4.rotate(x,x,null!==(h=null===(p=r.cameraRotation)||void 0===p?void 0:p[2])&&void 0!==h?h:0,[0,0,1]);for(var b=0,C=o;b<C.length;b++){var A=C[b];this.setPositionAttribute(t,A,e),this.setColorAttribute(t,A,e),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,A.indices),t.useProgram(e.program),t.uniformMatrix4fv(e.uniformLocations.projectionMatrix,!1,y),t.uniformMatrix4fv(e.uniformLocations.modelViewMatrix,!1,x);var P=A.verticles,N=t.UNSIGNED_SHORT;t.drawElements(t.TRIANGLES,P,N,0)}},t.setPositionAttribute=function(t,e,o){var r=t.FLOAT;t.bindBuffer(t.ARRAY_BUFFER,e.position),t.vertexAttribPointer(o.attribLocations.vertexPosition,3,r,!1,0,0),t.enableVertexAttribArray(o.attribLocations.vertexPosition)},t.setColorAttribute=function(t,e,o){var r=t.FLOAT;t.bindBuffer(t.ARRAY_BUFFER,e.color),t.vertexAttribPointer(o.attribLocations.vertexColor,4,r,!1,0,0),t.enableVertexAttribArray(o.attribLocations.vertexColor)},t}(),l=function(){function t(){}return t.initializeProgram=function(e){var o=t.initShaderProgram(e,"\n            attribute vec4 aVertexPosition;\n            attribute vec4 aVertexColor;\n\n            uniform mat4 uModelViewMatrix;\n            uniform mat4 uProjectionMatrix;\n\n            varying lowp vec4 vColor;\n\n            void main(void) {\n                gl_Position = uProjectionMatrix * uModelViewMatrix * aVertexPosition;\n                vColor = aVertexColor;\n            }\n        ","\n            varying lowp vec4 vColor;\n\n            void main(void) {\n                gl_FragColor = vColor;\n            }\n        ");if(!o)throw new Error("shader program");return{program:o,attribLocations:{vertexPosition:e.getAttribLocation(o,"aVertexPosition"),vertexColor:e.getAttribLocation(o,"aVertexColor")},uniformLocations:{projectionMatrix:e.getUniformLocation(o,"uProjectionMatrix"),modelViewMatrix:e.getUniformLocation(o,"uModelViewMatrix")}}},t.initShaderProgram=function(t,e,o){var r=this.loadShader(t,t.VERTEX_SHADER,e);if(!r)throw new Error("vertex shader");var n=this.loadShader(t,t.FRAGMENT_SHADER,o);if(!n)throw new Error("fragment shader");var i=t.createProgram();if(!i)throw new Error("shader program");return t.attachShader(i,r),t.attachShader(i,n),t.linkProgram(i),t.getProgramParameter(i,t.LINK_STATUS)?i:(alert("Unable to initialize the shader program: ".concat(t.getProgramInfoLog(i))),null)},t.loadShader=function(t,e,o){var r=t.createShader(e);if(!r)throw new Error("shader");return t.shaderSource(r,o),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS)?r:(alert("An error occurred compiling the shaders: ".concat(t.getShaderInfoLog(r))),t.deleteShader(r),null)},t}(),s=function(){return s=Object.assign||function(t){for(var e,o=1,r=arguments.length;o<r;o++)for(var n in e=arguments[o])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t},s.apply(this,arguments)};const u=function(){function t(t){this.paths=[],this.bufferers=[],this.animations=null,this.previousAnimationsLength=0,this.deltaX=0,this.deltaY=0,this.previous=0,this.options=t}return t.prototype.setOptions=function(t){this.options=s(s({},this.options),t)},t.prototype.setupContext=function(t){this.programInfo=l.initializeProgram(t)},t.prototype.setPaths=function(t,e,r,n){var i=this;void 0===e&&(e=null),void 0===r&&(r=!0);for(var a=NaN,l=NaN,s=NaN,u=NaN,c=NaN,v=NaN,f=NaN,d=NaN,p=0,h=t;p<h.length;p++)for(var m=0,g=h[p];m<g.length;m++){var y=g[m];y.projection=r?(null!=n?n:o.projectToPixelCoordinate).call(null!=n?n:o,y,this.options):{x:y.x,y:y.y,z:y.z},(window.isNaN(f)||y.projection.z<f)&&(f=y.projection.z),(window.isNaN(d)||y.projection.z>d)&&(d=y.projection.z),window.isNaN(a)&&(a=y.projection.x),window.isNaN(l)&&(l=y.projection.y),(window.isNaN(s)||y.projection.x<s)&&(s=y.projection.x),(window.isNaN(u)||y.projection.x>u)&&(u=y.projection.x),(window.isNaN(c)||y.projection.y<c)&&(c=y.projection.y),(window.isNaN(v)||y.projection.y>v)&&(v=y.projection.y)}var x=(u-s)/2,w=(v-c)/2,R=[0,1,0,1],b=[1,0,0,1];this.options.keepMinimumAltitude&&(f=0),this.paths=t.map((function(t){var e=[],o=0;return t.forEach((function(t,r){var n,s,u,c,v,p=(t.projection.z-f)/(d-f),h=t.projection.x,m=t.projection.y;null!==(n=i.options.keepMinimumPositions)&&void 0!==n&&n||null!==(s=i.options.center)&&void 0!==s&&!s?null!==(u=i.options.keepMinimumPositions)&&void 0!==u&&u||(h=t.projection.x-a,m=l-t.projection.y):(h=a>t.projection.x?a-t.projection.x:t.projection.x-a,m=l<t.projection.y?l-t.projection.y:t.projection.y-l),(null===(c=i.options.center)||void 0===c||c)&&(h-=x,m+=w);var g=t.projection.z-f,y=0===r?0:Math.abs(h-e[r-1].x),C=0===r?0:Math.abs(m-e[r-1].y),A=Math.sqrt(Math.pow(y,2)+Math.pow(C,2)),P={x:h,y:m,z:g,distanceX:y,distanceY:C,distance:A,distanceStart:o,verticles:null,color:i.options.elevationGradient?i.options.elevationGradientColors?[(i.options.elevationGradientColors[0][0]+(i.options.elevationGradientColors[1][0]-i.options.elevationGradientColors[0][0])*p)/255,(i.options.elevationGradientColors[0][1]+(i.options.elevationGradientColors[1][1]-i.options.elevationGradientColors[0][1])*p)/255,(i.options.elevationGradientColors[0][2]+(i.options.elevationGradientColors[1][2]-i.options.elevationGradientColors[0][2])*p)/255,(i.options.elevationGradientColors[0][3]+(i.options.elevationGradientColors[1][3]-i.options.elevationGradientColors[0][3])*p)/255]:[R[0]+(b[0]-R[0])*p,R[1]+(b[1]-R[1])*p,R[2]+(b[2]-R[2])*p,1]:null===(v=t.color)||void 0===v?void 0:v.map((function(t){return t/255}))};e.push(P),o+=A})),{points:e,fullDistance:o}})),this.animations=e,this.bufferers=[]},t.prototype.getAnimationFrame=function(t){void 0===t&&(t=0);var e={distanceFraction:1,elevationFraction:1};if(this.animations){var o=t-this.previous;this.previous=t;for(var r=0;r<this.animations.length;r++){var n=this.animations[r];n.progress||(n.progress={elapsed:0}),n.progress.elapsed+=o;var i=Math.max(Math.min(n.progress.elapsed/n.interval,1),0);switch(n.forwards||(i=1-i),i===(n.forwards?1:0)&&(n.repeat?(n.forwards=!n.forwards,delete n.progress):(this.animations.splice(r,1),r--)),n.type){case"distance":e.distanceFraction=i;break;case"elevation":e.elevationFraction=i}}}return e},t.prototype.registerMouseEvents=function(t){var e=this,o=!1,r=null,n=null;t.addEventListener("mousedown",(function(t){o=!0,r=t.pageX,n=t.pageY})),document.body.addEventListener("mouseup",(function(t){o=!1})),document.body.addEventListener("mousemove",(function(t){if(o&&null!==r&&null!==n){var i=t.pageX,a=t.pageY;e.deltaX+=i-r,e.deltaY+=a-n,r=i,n=a}}))},t.prototype.render=function(t,e,o){var r,n,i,l;if(!this.programInfo)throw new Error("Program info is not set up yet, you must call setupContext before rendering!");var s=null!==(n=null===(r=this.animations)||void 0===r?void 0:r.length)&&void 0!==n?n:0;(this.bufferers.length!==this.paths.length||(null===(i=this.animations)||void 0===i?void 0:i.length)||(null===(l=this.animations)||void 0===l?void 0:l.length)!==this.previousAnimationsLength)&&(this.bufferers=this.createBuffers(t,e)),a.drawScene(t,this.programInfo,this.bufferers,this.options,{x:this.deltaX,y:this.deltaY},o),this.previousAnimationsLength=s},t.prototype.createBuffers=function(t,e){var o=this,r=[],a=this.getAnimationFrame(e);return r.push.apply(r,this.paths.map((function(e){return i.createBuffers(t,e,o.options,a)}))),this.options.grid&&r.push(n.createBuffers(t,this.options,a,this.paths)),r},t}();const c=function(t,e){var o=new google.maps.WebGLOverlayView;return o.onAdd=o.onStateUpdate=o.onContextLost=o.onRemove=function(){},o.onContextRestored=function(e){var o=e.gl;t.setOptions({autoClear:!1,center:!1,keepPerspectiveProjection:!1}),t.setupContext(o)},o.onDraw=function(r){var n=r.gl,i=r.transformer;t.paths.length||t.setPaths(e,null,!0,(function(t,e){var o=i.fromLatLngAltitude({lat:t.latitude,lng:t.longitude,altitude:0}),r=mat4.create(),n=vec4.fromValues(0,0,0,1),a=vec4.create();return mat4.invert(r,o),vec4.transformMat4(a,n,r),{x:a[1]/3*2,y:a[0]/3*2,z:20*t.altitude}}));var a=i.fromLatLngAltitude({lat:e[0][0].latitude,lng:e[0][0].longitude,altitude:0});o.requestRedraw(),t.render(n,performance.now(),a)},o};return e})()));
//# sourceMappingURL=bundle.mjs.map